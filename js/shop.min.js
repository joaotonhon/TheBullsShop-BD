var countTotal = 0

async function products(id_marca, id_categoria) {
	await fetch("https://projeto-bd2.herokuapp.com/produtos", {
		headers: {
			"content-type": "application/json",
		},
		method: "GET",
	}).then(async (response) => {
		var product = document.querySelector(".tab-content .row");
		let min = 99999, max = 0, count = 0
		for (response of await response.json()) {
			if ((id_marca == 0 && id_categoria == 0) ||(id_marca != 0 && id_marca == response.marca) || (id_categoria != 0 && id_categoria == response.categoria)){
				var item = `
					<div class="col-sm-6 col-md-6 col-lg-4 col-xl-4">
						<div class="products-single fix">
							<div class="box-img-hover">
								<div class="type-lb">
								<p class="sale">PROMO</p>
							</div>
							<img src="https://projeto-bd2.herokuapp.com/files/${response.imagem}" class="img-fluid" alt="Image">
							<div class="mask-icon">
								<ul>
									<li><a href="#" data-toggle="tooltip" data-placement="right" title="Visualizar"><i class="fas fa-eye"></i></a></li>
								</ul>
								<a class="cart" onclick="addItemCart(${response.id_produto})">Adicionar ao carrinho</a>
							</div>
						</div>
						<div class="why-text">
							<h4>${response.nome}</h4>
							<h5>R$ ${(response.preco).toLocaleString('pt-BR',{minimumFractionDigits:2})}</h5>
						</div>
					</div>
				</div>`;
				min = response.preco < min? response.preco : min
				max = response.preco > max? response.preco : max

				product.insertAdjacentHTML("beforeend", item);
				count++;
			}
		}

		countTotal == 0? countTotal = count : countTotal 

		var total = document.querySelector("#totalItems")
		total.innerHTML =`Exibindo ${count} de ${countTotal} resultados`

		$(function() {
			$("#slider-range").slider({
				range: true,
				min: min,
				max: max,
				values: [min, max],
				slide: function(event, ui) {
					$("#amount").val("R$" + ui.values[0] + "  -  R$" + ui.values[1]);
				}
			});
			$("#amount").val("R$" + $("#slider-range").slider("values", 0) +
				"  -  R$" + $("#slider-range").slider("values", 1));
		});
	});
}

async function filterRequestBrand() {
    await fetch("https://projeto-bd2.herokuapp.com/marcas", {
      headers: {
        "content-type": "application/json",
      },
      method: "GET",
    }).then(async (response) => {
        var brand = document.querySelector('.brand-box ul')
		
        for (response of await response.json()) {
            var text = `
            <li>
                <div class="radio radio-danger">
                    <input name="survey" id="Radios${response.id_marca}" value="Yes" type="radio" onclick="filterBrand(${response.id_marca})">
                    <label for="Radios${response.id_marca}"> ${response.marca}</label>
                </div>
            </li>
            `
            brand.insertAdjacentHTML("afterbegin",text);
        }
        
    });
} 

async function filterRequestCategories() {
	await fetch("https://projeto-bd2.herokuapp.com/categorias", {
	  headers: {
		"content-type": "application/json",
	  },
	  method: "GET",
	}).then(async (response) => {
		var categories = document.querySelector('.list-group')
        for (response of await response.json()) {
            var text = `
            <div class="list-group-collapse sub-men">
                <a class="list-group-item list-group-item-action" href="#sub-men1" data-toggle="collapse" aria-expanded="true" aria-controls="sub-men1" onclick="filterCategories(${response.id_categoria})">${response.nome} <small class="text-muted">(100)</small></a>
            </div>
            `
            categories.insertAdjacentHTML("afterbegin",text);
        }
	});
  }
  

products(0,0);
filterRequestCategories();
filterRequestBrand(); 