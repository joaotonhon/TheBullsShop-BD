var cartList = new Object();
var total = 0

async function addItemCart(id) {
    await fetch("https://projeto-bd2.herokuapp.com/produtos", {
      headers: {
        "content-type": "application/json",
      },
      method: "GET",
    }).then(async (response) => {

      for (response of await response.json()) {
        if (id == response.id_produto){
          if (cartList[id] == null){
            cartList[id] = response
            cartList[id].count = 1;
            console.log(cartList)
            let list = document.querySelector(".cart-list");
            let html = `
            <li>
              <a href="#" class="photo"><img src="images/camisetabarcelona.jpg" class="cart-thumb" alt="" /></a>
              <h6><a href="#">${cartList[id].nome}</a></h6>
              <p class = priceid${id}>${cartList[id].count}x - <span class="price">${cartList[id].preco.toLocaleString('pt-BR',{minimumFractionDigits:2})}</span></p>
            </li> 
            `
            list.insertAdjacentHTML("afterbegin", html)
            total = total + response.preco
          }
          else{
            cartList[id].count++
            var price = document.querySelector(`.priceid${id}`)
            price.innerHTML = `${cartList[id].count}x - <span class="price">${cartList[id].preco.toLocaleString('pt-BR',{minimumFractionDigits:2})}</span>`
            total = total + response.preco
          }
          
          window.localStorage.setItem('cart', JSON.stringify(cartList));
          window.localStorage.setItem('total', total);

          var totalhtml = document.querySelector(".total .float-right")
          totalhtml.innerHTML = `
          <strong>Total</strong>: R$${total.toLocaleString('pt-BR',{minimumFractionDigits:2})}
          `
          var badge = document.querySelector(".badge")
          badge.innerHTML = `${Object.keys(cartList).length}`
         }
      }
    });
}

function cartRender(){
  cartList = JSON.parse(window.localStorage.getItem('cart'));

  for (let id of Object.keys(cartList)){
    let list = document.querySelector(".cart-list");
    let html = `
      <li>
        <a href="#" class="photo"><img src="images/camisetabarcelona.jpg" class="cart-thumb" alt="" /></a>
        <h6><a href="#">${cartList[id].nome}</a></h6>
        <p class = priceid${id}>${cartList[id].count}x - <span class="price">${cartList[id].preco.toLocaleString('pt-BR',{minimumFractionDigits:2})}</span></p>
      </li>
    `

    list.insertAdjacentHTML("afterbegin", html)

    total = parseFloat(window.localStorage.getItem('total'))
    
    var totalhtml = document.querySelector(".total .float-right")
          totalhtml.innerHTML = `
          <strong>Total</strong>: R$${total.toLocaleString('pt-BR',{minimumFractionDigits:2})}
          `
    var badge = document.querySelector(".badge")
    badge.innerHTML = `${Object.keys(cartList).length}`
  }
}

if (window.localStorage.getItem('cart') != null){
  cartRender();
}
