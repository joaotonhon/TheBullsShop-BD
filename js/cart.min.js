var cartList = new Object();

function cart(){
    cartList = JSON.parse(window.localStorage.getItem('cart'));

  for (let id of Object.keys(cartList)){
    let list = document.querySelector(".table tbody");
    let html = `
    <tr>
        <td class="thumbnail-img">
            <a href="#">
		        <img class="img-fluid" src="https://projeto-bd2.herokuapp.com/files/${response.imagem}" alt="" />
		    </a>
        </td>
        <td class="name-pr">
            <a href="#">
				${cartList[id].nome}
			</a>
        </td>
        <td class="price-pr">
            <p>R$ ${cartList[id].preco.toLocaleString('pt-BR',{minimumFractionDigits:2})}</p>
        </td>
        <td class="quantity-box"><input type="number" size="4" value="${cartList[id].count}" min="0" step="1" class="c-input-text qty text" id = input-value${id} onfocusout="updateField(${id})"></td>
        <td class="total-pr">
            <p id=indPrice${id}>R$ ${((cartList[id].preco)*(cartList[id].count)).toLocaleString('pt-BR',{minimumFractionDigits:2})}</p>
        </td>
        <td class="remove-pr">
            <a href="#">
				<i class="fas fa-times"></i>
		    </a>
        </td>
    </tr>
    `
    list.insertAdjacentHTML("afterbegin", html)

  }
}

function updateField(id){
    var inputNumber = document.querySelector(`#input-value${id}`)
    cartList[id].count = inputNumber.value

    var indPrice = document.querySelector(`#indPrice${id}`)
    indPrice.innerHTML = `R$ ${((cartList[id].preco)*(cartList[id].count)).toLocaleString('pt-BR',{minimumFractionDigits:2})}`

    window.localStorage.setItem('cart', JSON.stringify(cartList));
    totalFinal();
}


function totalFinal(){
    let total = 0;
    for (let id of Object.keys(cartList)){
        total = total + (cartList[id].count * cartList[id].preco)
    }

    let totalCart = document.querySelector("#totalCart")
    totalCart.innerHTML = `R$${total.toLocaleString('pt-BR',{minimumFractionDigits:2})}`

    window.localStorage.setItem('total', total);


}

cart();
totalFinal();